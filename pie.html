<!DOCTYPE html>
<div id="container"></div>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script type="module">

// Function for generating random data
function random_data() {
    const numValues = Math.floor(Math.random() * 6) + 5;
    const minValue = 0.1; // Make sure that each element will be somewhat visible
    let remaining = 1 - numValues * minValue;

    // Distribute remaining proportions randomly
    let randomParts = Array.from({ length: numValues }, () => Math.random());
    let totalRandom = randomParts.reduce((sum, val) => sum + val, 0);

    // Convert to ratios
    return randomParts.map(r => minValue + (r / totalRandom) * remaining);
}


// Function for creating a pie chart
function pie_chart(svg, data) {
  const pie = d3.pie();
  const arcs = pie(data);

  const pie_chart = svg.append("g")
    .attr("transform", "translate(500, 500)");

  pie_chart.selectAll("path")
    .data(arcs)
    .join("path")
    .attr("d", d3.arc()
      .innerRadius(0)
      .outerRadius(100)
    )
    .attr("fill", /*(d, i) => d3.schemeCategory10[i]*/"white")
    .attr("stroke", "black")
    .attr("stroke-width", 1)
    .each(function(d, i) {
      if (i == 2 || i == 3) {
        console.log(d.startAngle, "     ", d.endAngle);
        console.log((d.startAngle + d.endAngle) / 2);
        const angle = ((d.startAngle + (3 * Math.PI / 2)) + (d.endAngle + (3 * Math.PI / 2))) / 2
        pie_chart.append("circle")
            .attr("cx", Math.cos(angle) * 75)
            .attr("cy", Math.sin(angle) * 75)
            .attr("r", 5)
            .attr("fill", /*(d) => {
                if (i == 2) {
                    return "black";
                } else {
                    return "white";
                }
            }*/"black");
        const centroid = d3.arc()
            .innerRadius(0)
            .outerRadius(100)
            .centroid(d);
        /*
        pie_chart.append("text")
            .attr("x", centroid[0])
            .attr("y", centroid[1])
            .attr("text-anchor", "middle")
            .attr("alignment-baseline", "middle")
            .attr("fill", "Black")
            .text((d) => {
                if (i == 2) {
                    return "A";
                } else {
                    return "B";
                }
            });
        */
        }
    });
    
}


const svg = d3.select("#container")
  .append("svg")
  .attr("width", 1000)
  .attr("height", 1000);

// Generate some random data for a pie chart
var data = random_data();
//var data = [1, 1, 1, 2]
console.log(data);

// Create a pie chart
pie_chart(svg, data);

</script>