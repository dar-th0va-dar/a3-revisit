<!DOCTYPE html>
<div id="container"></div>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script type="module">

// Function for generating random data
function random_data() {
    const numValues = Math.floor(Math.random() * 4) + 5;
    const minValue = 0.1; // Make sure that each element will be somewhat visible
    let remaining = 1 - numValues * minValue;

    // Distribute remaining proportions randomly
    let randomParts = Array.from({ length: numValues }, () => Math.random());
    let totalRandom = randomParts.reduce((sum, val) => sum + val, 0);

    // Convert to ratios
    return randomParts.map(r => minValue + (r / totalRandom) * remaining);
}

// Function for generating the 2 marked points
function getIndices(size) {
    let first = d3.randomInt(0, size)();
    let second;
    do {
        second = d3.randomInt(0, size)();
    } while (second == first);
    return [first, second];
}

let pie1;
let pie2;

// Function for creating a pie chart
function pie_chart(svg, data) {
  const pie = d3.pie();
  const arcs = pie(data);

  const pie_chart = svg.append("g")
    .attr("transform", "translate(500, 500)");

  const indices = getIndices(data.length);
  console.log(indices);

  pie_chart.selectAll("path")
    .data(arcs)
    .join("path")
    .attr("d", d3.arc()
      .innerRadius(0)
      .outerRadius(100)
    )
    .attr("fill", "white")
    .attr("stroke", "black")
    .attr("stroke-width", 1)
    .each(function(d, i) {
      if (i == indices[0] || i == indices[1]) {
        const angle = ((d.startAngle + (3 * Math.PI / 2)) + (d.endAngle + (3 * Math.PI / 2))) / 2
        pie_chart.append("circle")
            .attr("cx", Math.cos(angle) * 75)
            .attr("cy", Math.sin(angle) * 75)
            .attr("r", 5)
            .attr("fill", "black");
        const centroid = d3.arc()
            .innerRadius(0)
            .outerRadius(100)
            .centroid(d);
        }
        if(i == indices[0]) {
            pie1 = d.data;
        } else {
            pie2 = d.data;
        }
    });
    
}


const svg = d3.select("#container")
  .append("svg")
  .attr("width", 1000)
  .attr("height", 1000);

// Generate some random data for a pie chart
var data = random_data();
//var data = [1, 1, 1, 2]
console.log(data);

// Create a pie chart
pie_chart(svg, data);
console.log("pies", pie1, pie2);

</script>